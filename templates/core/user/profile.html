{% extends 'base.html' %}

{% block title %}My Profile - NaturalBio{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Breadcrumb -->
    <div class="bg-neutral-50 py-4 mb-6 rounded-xl">
        <nav class="flex text-sm" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-2">
                <li><a href="{% url 'home' %}" class="text-neutral-500 hover:text-primary">Home</a></li>
                <li class="text-neutral-400"><i class="fas fa-chevron-right text-xs"></i></li>
                <li class="text-neutral-900 font-medium">My Profile</li>
            </ol>
        </nav>
    </div>

    <!-- Profile Header -->
    <div class="bg-gradient-to-r from-primary/5 to-accent/10 rounded-2xl p-8 mb-8 flex flex-col md:flex-row items-start md:items-center space-y-4 md:space-y-0 md:space-x-6">
        <div class="relative">
            <img src="https://images.unsplash.com/photo-1494790108755-2616b612b3c9?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80"
                 alt="Profile Picture"
                 class="w-24 h-24 rounded-full object-cover shadow-lg">
        </div>
        <div class="flex-1">
            <h1 class="text-2xl font-heading font-bold text-neutral-900 mb-2">{{ user.get_full_name }}</h1>
            <p class="text-neutral-600 mb-2">Customer since {{ user.date_joined|date:"F Y" }}</p>
        </div>
        <div class="flex space-x-3">
            <button onclick="toggleEditProfile()" class="px-6 py-2 bg-primary text-white font-medium rounded-lg hover:bg-primary-600">
                Edit Profile
            </button>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- Left column: personal info + orders -->
        <div class="lg:col-span-2 space-y-8">

            <!-- Personal Info -->
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-neutral-100">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-heading font-bold text-neutral-900">Personal Information</h2>
                    <button onclick="toggleEditProfile()" class="text-primary hover:text-primary-600 text-sm font-medium">
                        <i class="fas fa-edit mr-1"></i> Edit
                    </button>
                </div>

                <!-- View -->
                <div id="profile-view" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <p><strong>First Name:</strong> {{ user.first_name }}</p>
                    <p><strong>Last Name:</strong> {{ user.last_name }}</p>
                    <p><strong>Email:</strong> {{ user.email }}</p>
                    <p><strong>Phone:</strong> {{ profile.phone }}</p>
                    <p><strong>Address:</strong> {{ profile.address }}</p>
                    <p><strong>City:</strong> {{ profile.city }}</p>
                </div>

                <!-- Edit -->
                <div id="profile-edit" class="hidden">
                    <form method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {% csrf_token %}
                        <input type="text" name="first_name" value="{{ user.first_name }}" class="border rounded p-2">
                        <input type="text" name="last_name" value="{{ user.last_name }}" class="border rounded p-2">
                        <input type="email" name="email" value="{{ user.email }}" class="border rounded p-2">
                        <input type="text" name="phone" value="{{ profile.phone }}" class="border rounded p-2">
                        <input type="text" name="address" value="{{ profile.address }}" class="border rounded p-2">
                        <input type="text" name="city" value="{{ profile.city }}" class="border rounded p-2">

                        <div class="md:col-span-2 flex space-x-3 mt-4">
                            <button type="submit" class="px-6 py-2 bg-primary text-white rounded hover:bg-primary-600">Save</button>
                            <button type="button" onclick="cancelEditProfile()" class="px-6 py-2 border rounded hover:bg-neutral-50">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Orders -->
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-neutral-100">
                <h2 class="text-xl font-heading font-bold text-neutral-900 mb-6">Recent Orders</h2>
                {% for order in orders %}
                    <div class="border border-neutral-200 rounded-lg p-4 mb-4">
                        <div class="flex justify-between mb-2">
                            <h3 class="font-semibold text-neutral-900">Order #{{ order.order_number }}</h3>
                            <span class="px-3 py-1 rounded-full text-sm
                                {% if order.status == 'delivered' %}bg-success/10 text-success{% else %}bg-warning/10 text-warning{% endif %}">
                                {{ order.get_status_display }}
                            </span>
                        </div>
                        <p class="text-sm text-neutral-600">{{ order.created_at|date:"M d, Y" }}</p>
                        <div class="mt-2">
                            {% for item in order.items.all %}
                                <p class="text-sm">{{ item.quantity }}x {{ item.product.name }} - {{ item.total_price|floatformat:0 }} XOF</p>
                            {% endfor %}
                        </div>
                    </div>
                {% empty %}
                    <p>No recent orders.</p>
                {% endfor %}
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="space-y-6">
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-neutral-100">
                <a href="{% url 'wishlist' %}" class="flex justify-between p-3 hover:bg-neutral-50 rounded-lg">
                    <span>Wishlist</span>
                    {% if wishlist %}{{ wishlist.products.count }}{% else %}0{% endif %}
                </a>
                <a href="{% url 'cart_detail' %}" class="flex justify-between p-3 hover:bg-neutral-50 rounded-lg">
                    <span>Cart</span>
                    {% if cart %}{{ cart.total_items }}{% else %}0{% endif %}
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function toggleEditProfile(){
    document.getElementById('profile-view').classList.add('hidden');
    document.getElementById('profile-edit').classList.remove('hidden');
}
function cancelEditProfile(){
    document.getElementById('profile-edit').classList.add('hidden');
    document.getElementById('profile-view').classList.remove('hidden');
}
</script>
{% endblock %}
