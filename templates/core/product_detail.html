{% extends 'base.html' %}

{% block title %}{{ product.name }} - {{ product.category.name }}{% endblock %}
{% block meta_description %}{{ product.description|truncatechars:160|striptags }}{% endblock %}

{% block breadcrumb %}
<div class="bg-gray-50 py-4">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <nav class="flex text-sm" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-2">
                <li><a href="/" class="text-gray-500 hover:text-green-600 transition-colors">Accueil</a></li>
                <li class="text-gray-400"><i class="fas fa-chevron-right text-xs"></i></li>
                <li class="text-gray-900 font-medium">{{ product.name }}</li>
            </ol>
        </nav>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Bouton retour -->
    <button onclick="history.back()" class="mb-6 flex items-center text-gray-600 hover:text-green-600 transition-colors">
        <i class="fas fa-arrow-left mr-2"></i>
        Retour aux produits
    </button>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">

        <!-- Section Images + Carousel -->
        <div x-data="carousel()" class="space-y-4">

            <!-- Image principale -->
            <div class="aspect-[4/3] bg-gray-100 rounded-3xl overflow-hidden relative group">
                <img :src="images[active]" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105 rounded-3xl cursor-zoom-in">
            </div>

            <!-- Carousel miniatures -->
            <div class="flex space-x-3 overflow-x-auto">
                <template x-for="(img, index) in images" :key="index">
                    <img :src="img"
                         @click="active = index"
                         :class="active === index ? 'ring-2 ring-primary rounded-xl' : 'rounded-xl'"
                         class="w-20 h-20 object-cover cursor-pointer transition-transform duration-300 hover:scale-105">
                </template>
            </div>
        </div>

        <!-- Informations produit -->
        <div class="space-y-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">{{ product.name }}</h1>

            <!-- Catégorie -->
            {% if product.category %}
            <span class="inline-block bg-gray-100 text-gray-800 text-xs font-semibold px-3 py-1 rounded-full shadow-sm mb-4">
                {{ product.category.name }}
            </span>
            {% endif %}

            <!-- Prix -->
            <div class="text-3xl font-bold text-green-600 mt-2">
                {{ product.price|floatformat:0 }} XOF
            </div>

            <!-- Stock -->
            {% if product.is_available %}
            <div class="text-sm text-green-600 font-medium mt-1">En stock - {{ product.stock }} disponible(s)</div>
            {% else %}
            <div class="text-sm text-red-600 font-medium mt-1">Rupture de stock</div>
            {% endif %}

            <!-- Bouton commande WhatsApp -->
            <div class="mt-6">
                <a href="https://wa.me/{{ site_info.phone_primary|urlencode }}?text=Bonjour%2C%20je%20souhaite%20commander%20{{ product.name|urlencode }}" 
                   target="_blank"
                   class="inline-flex items-center justify-center gap-3 bg-green-500 hover:bg-green-600 text-white font-semibold py-4 px-6 rounded-lg transition-all duration-300 text-lg shadow-lg">
                    <i class="fab fa-whatsapp text-2xl"></i>
                    Commander via WhatsApp
                </a>
            </div>
        </div>
    </div>

    <!-- Tabs Description / Détails / Avis -->
    <div x-data="{ tab: 'description' }" class="mt-12">
        <div class="flex border-b border-gray-200">
            <button @click="tab='description'" :class="tab==='description' ? 'border-b-2 border-primary text-primary font-semibold' : 'text-gray-600'" class="px-6 py-3">
                Description
            </button>
            <button @click="tab='details'" :class="tab==='details' ? 'border-b-2 border-primary text-primary font-semibold' : 'text-gray-600'" class="px-6 py-3">
                Détails
            </button>
            <button @click="tab='reviews'" :class="tab==='reviews' ? 'border-b-2 border-primary text-primary font-semibold' : 'text-gray-600'" class="px-6 py-3">
                Avis
            </button>
        </div>

        <div class="mt-6">
            <div x-show="tab==='description'" class="text-gray-700 leading-relaxed" x-transition>
                {{ product.description|safe }}
            </div>
            <div x-show="tab==='details'" class="text-gray-700 leading-relaxed" x-transition>
                <ul class="list-disc ml-5">
                    <li>Catégorie: {{ product.category.name }}</li>
                    <li>Prix: {{ product.price|floatformat:0 }} XOF</li>
                    <li>Stock: {% if product.is_available %} Disponible {% else %} Rupture {% endif %}</li>
                    <li>Créé le: {{ product.created_at|date:"d/m/Y" }}</li>
                </ul>
            </div>
            <div x-show="tab==='reviews'" class="text-gray-700 leading-relaxed" x-transition>
                {% comment %} Ici tu peux intégrer les reviews {% endcomment %}
                <p>Aucun avis pour l'instant.</p>
            </div>
        </div>
    </div>

    <!-- Produits similaires -->
    {% if similar_products %}
    <div class="mt-12">
        <h2 class="text-2xl font-bold mb-6">Produits similaires</h2>
        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
            {% for sp in similar_products %}
            <div class="bg-white rounded-2xl shadow-md hover:shadow-lg overflow-hidden">
                <a href="{% url 'product_detail' sp.slug %}">
                    <img src="{{ sp.image.url }}" alt="{{ sp.name }}" class="w-full h-48 object-cover transition-transform duration-500 hover:scale-105">
                </a>
                <div class="p-3">
                    <h3 class="text-gray-900 font-semibold text-sm truncate">{{ sp.name }}</h3>
                    <div class="text-green-600 font-bold">{{ sp.price|floatformat:0 }} XOF</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

</div>

<!-- Alpine.js pour carousel et tabs -->
<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<script>
function carousel() {
    return {
        active: 0,
        images: [
            {% if product.image %}
            '{{ product.image.url }}',
            {% endif %}
            {% for img in product.images.all %}
            '{{ img.image.url }}',
            {% endfor %}
        ]
    }
}
</script>
{% endblock %}
